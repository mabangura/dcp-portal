'use client';import { useState } from 'react';export default function MergePage(){const [left,setLeft]=useState<File|null>(null);const [right,setRight]=useState<File|null>(null);const [leftKey,setLeftKey]=useState('household_id');const [rightKey,setRightKey]=useState('household_id');const [report,setReport]=useState<any>(null);const [outB64,setOutB64]=useState<string>('');async function run(){if(!left||!right)return;const fd=new FormData();fd.append('left',left);fd.append('right',right);fd.append('left_key',leftKey);fd.append('right_key',rightKey);fd.append('how','left');const res=await fetch('/api/importer/merge/run',{method:'POST',body:fd});const data=await res.json();setReport(data.report||data.error);setOutB64(data.merged_csv_base64||'');}function download(){if(!outB64)return;const blob=new Blob([Uint8Array.from(atob(outB64),c=>c.charCodeAt(0))],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='merged.csv';a.click();URL.revokeObjectURL(url);}return(<div><h1 className="text-xl font-semibold mb-4">Merge Datasets (MVP)</h1><div className="card space-y-3"><input type="file" accept=".csv,.json" onChange={e=>setLeft(e.target.files?.[0]||null)} /><input type="file" accept=".csv,.json" onChange={e=>setRight(e.target.files?.[0]||null)} /><div className="grid grid-cols-2 gap-2"><input className="w-full border p-2 rounded" value={leftKey} onChange={e=>setLeftKey(e.target.value)} placeholder="Left join key" /><input className="w-full border p-2 rounded" value={rightKey} onChange={e=>setRightKey(e.target.value)} placeholder="Right join key" /></div><div className="flex gap-2"><button className="btn btn-primary" onClick={run}>Run merge</button><button className="btn" onClick={download} disabled={!outB64}>Download CSV</button></div></div>{report&&<div className="card mt-4"><pre className="text-xs overflow-auto">{JSON.stringify(report,null,2)}</pre></div>}</div>);}